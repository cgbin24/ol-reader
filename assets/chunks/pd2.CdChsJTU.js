import{a as d,x as N,o as S,i as m,j as f,D as a,X as D,Y as W,p as h,C as j,E as T,F as E}from"./@vue.Br72Imo5.js";import{a as I,b as R,c as w}from"./pdfjs-dist.D1DTk0ec.js";import{_ as V}from"../app.D_DTQrLX.js";const B=r=>(T("data-v-eb87600d"),r=r(),E(),r),$={class:"pdfPreview"},q={class:"page-tool"},F={class:"page-tool-item"},G={key:0,class:"loading"},O=B(()=>a("div",{class:"loading-content"},[a("div",{class:"loading-icon"}),a("div",{class:"loading-text"},"Loading...")],-1)),z=[O],A={__name:"pd2",props:{src:{type:String,required:!0}},setup(r){I.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${R}/pdf.worker.min.mjs`;const u=r,s=d(null),t=N({source:u.src,pageNum:1,scale:1,numPages:1}),x=d(!0),g=d(null),l=d(!1);S(async()=>{o("init GlobalWorkerOptions"),l.value=!0,setTimeout(()=>{b()},1e3)});const P=()=>{t.pageNum>1&&(t.pageNum-=1,_())},y=()=>{t.pageNum<t.numPages&&(t.pageNum+=1,_())},k=(e,c=1e4)=>Promise.race([fetch(e),new Promise((n,i)=>setTimeout(()=>i(o("Request timed out")),c))]),b=async()=>{try{if(s.value){o("init");const e=await w({url:u.src,fetch:k}).promise;o("init getDocument"),t.numPages=e.numPages,await v()}}catch(e){console.error("Error initializing PDF viewer:",e),o(e)}finally{l.value=!1}},v=async()=>{o("renderPage");try{if(s.value){const c=await(await w(u.src).promise).getPage(t.pageNum),n=c.getViewport({scale:t.scale});console.log("viewport:",n);const i=s.value.getContext("2d");if(i){o("renderPage context");const p=window.devicePixelRatio||1;s.value.width=n.width*p,s.value.height=n.height*p,s.value.style.width=`${g.value.style.width}px`,s.value.style.height=`${g.value.style.height}px`,i.setTransform(p,0,0,p,0,0);const C={canvasContext:i,viewport:n};await c.render(C).promise,l.value=!1,o("renderPage success")}}}catch(e){console.error("Error rendering page:",e)}},_=async()=>{await v()},o=e=>{alert(e),console.log(e)};return(e,c)=>(m(),f("div",$,[a("div",{class:"pdfWrap",ref_key:"pWrapRef",ref:g},[a("canvas",{ref_key:"canvas",ref:s,class:"pdfCanvas"},null,512)],512),D(a("div",q,[a("div",{class:"page-tool-item",onClick:P},"pre"),a("div",{class:"page-tool-item",onClick:y},"next"),a("div",F,h(t.pageNum)+" / "+h(t.numPages),1)],512),[[W,x.value]]),l.value?(m(),f("div",G,z)):j("",!0)]))}},Y=V(A,[["__scopeId","data-v-eb87600d"]]);export{Y as P};
