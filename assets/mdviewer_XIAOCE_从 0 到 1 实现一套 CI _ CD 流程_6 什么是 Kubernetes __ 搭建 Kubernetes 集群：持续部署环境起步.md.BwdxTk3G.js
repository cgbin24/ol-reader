import{_ as s}from"./app.BdTF1atn.js";import{j as i,i as a,Z as e}from"./chunks/@vue.D6nrJjhM.js";/* empty css                          */import"./chunks/@vueuse.ErXst1iV.js";const b=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"mdviewer/XIAOCE/ä» 0 åˆ° 1 å®ç°ä¸€å¥— CI & CD æµç¨‹/6 ä»€ä¹ˆæ˜¯ Kubernetes && æ­å»º Kubernetes é›†ç¾¤ï¼šæŒç»­éƒ¨ç½²ç¯å¢ƒèµ·æ­¥.md","filePath":"mdviewer/XIAOCE/ä» 0 åˆ° 1 å®ç°ä¸€å¥— CI & CD æµç¨‹/6 ä»€ä¹ˆæ˜¯ Kubernetes && æ­å»º Kubernetes é›†ç¾¤ï¼šæŒç»­éƒ¨ç½²ç¯å¢ƒèµ·æ­¥.md"}'),n={name:"mdviewer/XIAOCE/ä» 0 åˆ° 1 å®ç°ä¸€å¥— CI & CD æµç¨‹/6 ä»€ä¹ˆæ˜¯ Kubernetes && æ­å»º Kubernetes é›†ç¾¤ï¼šæŒç»­éƒ¨ç½²ç¯å¢ƒèµ·æ­¥.md"},t=e(`<h3 id="ä»€ä¹ˆæ˜¯-kubernetes" tabindex="-1">ä»€ä¹ˆæ˜¯ Kubernetesï¼Ÿ â€‹</h3><p>ç™¾ç§‘ä¸Šæ˜¯è¿™æ ·è§£é‡Šçš„ï¼š</p><blockquote><p>Kubernetes æ˜¯ Google å¼€æºçš„ä¸€ä¸ªå®¹å™¨ç¼–æ’å¼•æ“ï¼Œå®ƒæ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²ã€å¤§è§„æ¨¡å¯ä¼¸ç¼©ã€åº”ç”¨å®¹å™¨åŒ–ç®¡ç†ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸è¦éƒ¨ç½²è¯¥åº”ç”¨çš„å¤šä¸ªå®ä¾‹ä»¥ä¾¿å¯¹åº”ç”¨è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</p></blockquote><p>é€šä¿—äº›è®²ï¼Œå¯ä»¥å°† <code>Kubernetes</code> çœ‹ä½œæ˜¯ç”¨æ¥æ˜¯ä¸€ä¸ªéƒ¨ç½²é•œåƒçš„å¹³å°ã€‚å¯ä»¥ç”¨æ¥æ“ä½œå¤šå°æœºå™¨è°ƒåº¦éƒ¨ç½²é•œåƒï¼Œå¤§å¤§åœ°é™ä½äº†è¿ç»´æˆæœ¬ã€‚</p><p>é‚£ä¹ˆï¼Œ <code>Kubernetes</code> å’Œ <code>Docker</code> çš„å…³ç³»åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p><strong>ä¸€ä¸ªå½¢è±¡çš„æ¯”å–»ï¼šå¦‚æœä½ å°† <code>docker</code> çœ‹ä½œæ˜¯é£æœºï¼Œé‚£ä¹ˆ <code>kubernetes</code> å°±æ˜¯é£æœºåœºã€‚åœ¨é£æœºåœºçš„åŠ æŒä¸‹ï¼Œé£æœºå¯ä»¥æ ¹æ®æœºåœºè°ƒåº¦é€‰æ‹©åœ¨åˆé€‚çš„æ—¶é—´é™è½æˆ–èµ·é£</strong>ã€‚</p><p>åœ¨ <code>Kubernetes</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é›†ç¾¤æ¥ç»„ç»‡æœåŠ¡å™¨çš„ã€‚é›†ç¾¤ä¸­ä¼šå­˜åœ¨ä¸€ä¸ª <code>Master</code> èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æ˜¯ <code>Kubernetes</code> é›†ç¾¤çš„æ§åˆ¶èŠ‚ç‚¹ï¼Œè´Ÿè´£è°ƒåº¦é›†ç¾¤ä¸­å…¶ä»–æœåŠ¡å™¨çš„èµ„æºã€‚å…¶ä»–èŠ‚ç‚¹è¢«ç§°ä¸º <code>Node</code> ï¼Œ <code>Node</code> å¯ä»¥æ˜¯ç‰©ç†æœºä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœºã€‚</p><h3 id="åŸºç¡€å®‰è£…" tabindex="-1">åŸºç¡€å®‰è£… â€‹</h3><p><strong>åŸºç¡€å®‰è£…ç« èŠ‚ï¼ŒMaster &amp; Node èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…</strong></p><p>ç¬¬ä¸€æ­¥æˆ‘ä»¬å®‰è£…äº›å¿…å¤‡ç»„ä»¶ã€‚ <code>vim</code> æ˜¯ <code>Linux</code> ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ç¼–è¾‘å™¨ï¼› <code>wget</code> å¯ä»¥ç”¨ä½œæ–‡ä»¶ä¸‹è½½ä½¿ç”¨ï¼› <code>ntpdate</code> åˆ™æ˜¯å¯ä»¥ç”¨æ¥åŒæ­¥æ—¶åŒºï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ntpdate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å…³é—­é˜²ç«å¢™ã€‚å› ä¸º <code>**kubernetes</code> ä¼šåˆ›å»ºé˜²ç«å¢™è§„åˆ™ï¼Œå¯¼è‡´é˜²ç«å¢™è§„åˆ™é‡å¤**ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦å°†é˜²ç«å¢™å…³é—­ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewalld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewalld</span></span></code></pre></div><p>è¿™ä¸€æ­¥éœ€è¦æˆ‘ä»¬å…³é—­ <code>Swap</code> åˆ†åŒºã€‚ <code>Swap</code> æ˜¯ <code>Linux</code> çš„äº¤æ¢åˆ†åŒºï¼Œåœ¨ç³»ç»Ÿèµ„æºä¸è¶³æ—¶ï¼Œ<code>Swap</code> åˆ†åŒºä¼šå¯ç”¨ã€‚è¿™æ“ä½œä¼šæ‹–æ…¢æˆ‘ä»¬çš„åº”ç”¨æ€§èƒ½ã€‚</p><p>åº”è¯¥è®©æ–°åˆ›å»ºçš„æœåŠ¡è‡ªåŠ¨è°ƒåº¦åˆ°é›†ç¾¤çš„å…¶ä»– <code>Node</code> èŠ‚ç‚¹ä¸­å»ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>Swap</code> åˆ†åŒºã€‚è¿™é‡Œæˆ‘ä»¬å°†å®ƒå…³é—­æ‰ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#ä¸´æ—¶å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">swapoff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ°¸ä¹…å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/fstab</span></span></code></pre></div><p>æ‰¾åˆ° <code>/etc/fstab</code> æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰ä¸‹é¢è¿™ä¸€è¡Œï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/centos-swap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span></code></pre></div><p>ç»§ç»­å…³é—­ <code>Selinux</code>ã€‚è¿™æ˜¯ä¸ºäº†æ”¯æŒå®¹å™¨å¯ä»¥è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ‰€åšçš„ï¼Œåç»­ä¹Ÿè®¸ä¼šä¼˜åŒ–æ‰ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æš‚æ—¶å…³é—­ selinux</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ°¸ä¹…å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysconfig/selinux</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼Œè®¾ç½®ä¸ºdisable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SELINUX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">disabled</span></span></code></pre></div><blockquote><p><strong>å…³äºä¸ºä»€ä¹ˆå…³é—­é˜²ç«å¢™ï¼Œselinuxï¼Œswapã€‚è¿™é‡Œæœ‰å‡ ä»½æ›´æ ‡å‡†çš„å›ç­”ï¼šhttps://www.zhihu.com/question/374752553</strong></p></blockquote><p>æ¥ç€ä½¿ç”¨ <code>ntpdate</code> æ¥ç»Ÿä¸€æˆ‘ä»¬çš„ç³»ç»Ÿæ—¶é—´å’Œæ—¶åŒºï¼ŒæœåŠ¡å™¨æ—¶é—´ä¸é˜¿é‡Œäº‘æœåŠ¡å™¨å¯¹é½ã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»Ÿä¸€æ—¶åŒºï¼Œä¸ºä¸Šæµ·æ—¶åŒº</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -snf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/zoneinfo/Asia/Shanghai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/localtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;echo &#39;Asia/Shanghai&#39; &gt; /etc/timezone&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»Ÿä¸€ä½¿ç”¨é˜¿é‡ŒæœåŠ¡å™¨è¿›è¡Œæ—¶é—´æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ntpdate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ntp1.aliyun.com</span></span></code></pre></div><h4 id="å®‰è£…-docker" tabindex="-1">å®‰è£… Docker â€‹</h4><p>åœ¨ <code>kubernetes</code> ä¸­çš„ç»„ä»¶ï¼ŒæœåŠ¡éƒ½å¯ä»¥ <code>Docker</code> é•œåƒæ–¹å¼éƒ¨ç½²çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å®‰è£… <code>Docker</code> å¿…ä¸å¯å°‘ã€‚</p><p>åœ¨å®‰è£… <code>Docker</code> ä¹‹å‰ï¼Œéœ€è¦å®‰è£… <code>device-mapper-persistent-data</code> å’Œ <code>lvm2</code> ä¸¤ä¸ªä¾èµ–ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>Yum</code> å‘½ä»¤ç›´æ¥å®‰è£…ä¾èµ–å³å¯ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum-utils</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> device-mapper-persistent-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lvm2</span></span></code></pre></div><blockquote><p><code>device-mapper-persistent-data</code>: å­˜å‚¨é©±åŠ¨ï¼ŒLinuxä¸Šçš„è®¸å¤šé«˜çº§å·ç®¡ç†æŠ€æœ¯ lvm: é€»è¾‘å·ç®¡ç†å™¨ï¼Œç”¨äºåˆ›å»ºé€»è¾‘ç£ç›˜åˆ†åŒºä½¿ç”¨</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæ·»åŠ é˜¿é‡Œäº‘çš„ <code>Docker</code> é•œåƒæºï¼ŒåŠ é€Ÿ <code>Docker</code> çš„å®‰è£…ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum-config-manager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><p>æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹<code>docker</code>çš„<code>cgroupdriver</code>ä¸º<code>systemd</code>ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†é¿å…åé¢ä¸<code>k8s</code>çš„å†²çªã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/docker/daemon.json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><p>å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬ä½¿ç”¨ä½¿ç”¨ <code>systemctl</code> å¯åŠ¨ <code>Docker</code> å³å¯</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div><p>æ‰§è¡Œ <code>docker -v</code> ï¼Œå¦‚æœæ˜¾ç¤ºä»¥ä¸‹ <code>docker</code> ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œä»£è¡¨ <code>docker</code> å®‰è£…æˆåŠŸã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/222a2a0b50414b77909cfde5050373dc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" loading="lazy"></p><p>æˆ‘ä»¬æ‹‰å– <code>Docker</code> é•œåƒæ—¶ï¼Œä¸€èˆ¬é»˜è®¤ä¼šå» <code>Docker</code> å®˜æ–¹æºæ‹‰å–é•œåƒã€‚ä½†æ˜¯å›½å†…å‡ºæµ·ç½‘é€Ÿå®åœ¨æ˜¯å¤ªæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ¢ä¸º <code>é˜¿é‡Œäº‘é•œåƒä»“åº“</code> æºè¿›è¡Œé•œåƒä¸‹è½½åŠ é€Ÿ</p><p>ç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæ‰“å¼€ é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ã€‚ç‚¹å‡»å·¦ä¾§èœå•æœ€ä¸‹é¢çš„ <code>é•œåƒåŠ é€Ÿå™¨</code> ï¼Œé€‰æ‹© <code>Centos</code> ï¼ˆå¦‚ä¸‹å›¾ï¼‰</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b0ba7bb836e4ead8aef34a0ac29166d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" loading="lazy"></p><p>æŒ‰ç…§å®˜ç½‘çš„æç¤ºï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œå³å¯å®ç°æ›´æ¢ Docker é•œåƒæºåœ°å€ã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬å‰é¢å®‰è£…ç§æœ‰é•œåƒåº“æ—¶çš„ä½¿ç”¨æç¤ºå—ï¼Ÿåœ¨å®‰è£…å®Œ <code>Docker</code> åï¼Œ<strong>å¦‚æœä½ çš„ç§æœ‰é•œåƒåº“æ˜¯ <code>HTTP</code> è€Œä¸æ˜¯ <code>HTTPS</code> çš„è¯ï¼Œéœ€è¦åœ¨ <code>/etc/docker/daemon.json</code> é‡Œé…ç½®ä¸€ä¸‹ä½ çš„ç§æœ‰åº“åœ°å€</strong>ã€‚</p><p>ç¼–è¾‘ <code>/etc/docker/daemon.json</code> æ–‡ä»¶ï¼Œæ·»åŠ  <code>insecure-registries</code> å­—æ®µã€‚å­—æ®µçš„å€¼æ˜¯æ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹å¡«å…¥ä½ çš„ç§æœ‰åº“åœ°å€å³å¯ï¼ˆä¸è¦å¿˜è®°åé¢çš„é€—å·ï¼‰ã€‚å¦‚ç¤ºä¾‹ï¼š</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;insecure-registries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://[ç§æœ‰åº“åœ°å€]:[ç§æœ‰åº“ç«¯å£]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;registry-mirrors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://*****.mirror.aliyuncs.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ä¿å­˜åé€€å‡ºï¼Œé‡å¯ä¸‹ <code>Docker</code> æœåŠ¡ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.service</span></span></code></pre></div><h4 id="å®‰è£…-kubernetes-ç»„ä»¶" tabindex="-1">å®‰è£… Kubernetes ç»„ä»¶ â€‹</h4><p>ä»è¿™é‡Œæˆ‘ä»¬å¼€å§‹å®‰è£… <code>Kubernetes</code> çš„ç›¸å…³ç»„ä»¶ï¼Œé¦–å…ˆå…ˆå°†å®‰è£…æºæ›´æ¢ä¸ºä¸ºå›½å†…çš„é˜¿é‡Œäº‘æºï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[kubernetes]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">name=Kubernetes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gpgcheck=0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">repo_gpgcheck=0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><p>æ¥ç€ç›´æ¥ä½¿ç”¨ <code>yum</code> å‘½ä»¤å®‰è£… <code>kubelet</code>ã€ <code>kubeadm</code>ã€<code>kubectl</code> å³å¯ï¼Œå®‰è£…å®Œæ¯•åå¯ç”¨ <code>kubelet</code> å³å¯ã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet-1.23.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubeadm-1.23.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl-1.23.6</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨kubelet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet</span></span></code></pre></div><blockquote><p><code>kubelet</code> æ˜¯ <code>Kubernetes</code> ä¸­çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒä¼šè¿è¡Œåœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œå¹¶è´Ÿè´£åˆ›å»ºå¯åŠ¨æœåŠ¡å®¹å™¨ <code>kubectl</code> åˆ™æ˜¯<code>Kubernetes</code>çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å¯ä»¥ç”¨æ¥ç®¡ç†ï¼Œåˆ é™¤ï¼Œåˆ›å»ºèµ„æº <code>kubeadm</code> åˆ™æ˜¯ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤ï¼Œå­èŠ‚ç‚¹åŠ å…¥çš„å·¥å…·ã€‚</p></blockquote><h3 id="master-èŠ‚ç‚¹å®‰è£…" tabindex="-1">Master èŠ‚ç‚¹å®‰è£… â€‹</h3><p><code>Master</code> èŠ‚ç‚¹æ˜¯é›†ç¾¤å†…çš„è°ƒåº¦å’Œä¸»è¦èŠ‚ç‚¹ï¼Œ<strong>ä»¥ä¸‹éƒ¨åˆ†ä»…é™ <code>Master</code> èŠ‚ç‚¹æ‰èƒ½å®‰è£…</strong>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>hostnamectl</code> æ¥ä¿®æ”¹ä¸»æœºåç§°ä¸º <code>master</code> ã€‚<code>hostnamectl</code> æ˜¯ <code>Centos7</code> å‡ºçš„æ–°å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹ä¸»æœºåç§°ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  master</span></span></code></pre></div><p>æ¥ç€ä½¿ç”¨ <code>ip addr</code> å‘½ä»¤ï¼Œè·å–æœ¬æœºIPï¼Œå°†å…¶æ·»åŠ åˆ° <code>/etc/hosts</code> å†…ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># xxx.xxx.xxx.xxx master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span></code></pre></div><h4 id="é…ç½®-kubernetes-åˆå§‹åŒ–æ–‡ä»¶" tabindex="-1">é…ç½® Kubernetes åˆå§‹åŒ–æ–‡ä»¶ â€‹</h4><p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨ <code>kubeadm config print init-defaults</code> è¾“å‡ºä¸€ä»½é»˜è®¤åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ &gt; æ“ä½œç¬¦å³å¯å¯¼å‡ºä¸ºä¸€ä»½æ–‡ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œä¿®æ”¹ã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> print</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init-defaults</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init-kubeadm.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init-kubeadm.conf</span></span></code></pre></div><p>ä¸»è¦å¯¹é…ç½®æ–‡ä»¶åšè¿™å‡ ä»¶äº‹æƒ…ï¼š</p><ul><li>æ›´æ¢ <code>Kubernetes</code> é•œåƒä»“åº“ä¸ºé˜¿é‡Œäº‘é•œåƒä»“åº“ï¼ŒåŠ é€Ÿç»„ä»¶æ‹‰å–</li><li>æ›¿æ¢ <code>ip</code> ä¸ºè‡ªå·±ä¸»æœº <code>ip</code></li><li>é…ç½® <code>pod</code> ç½‘ç»œä¸º <code>flannel</code> ç½‘æ®µ</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># imageRepository: k8s.gcr.io æ›´æ¢k8sé•œåƒä»“åº“</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">imageRepository:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.cn-hangzhou.aliyuncs.com/google_containers</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># localAPIEndpointcï¼ŒadvertiseAddressä¸ºmaster-ip ï¼Œporté»˜è®¤ä¸ä¿®æ”¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localAPIEndpoint:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  advertiseAddress:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.56.101</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ­¤å¤„ä¸ºmasterçš„IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  bindPort:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6443</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é…ç½®å­ç½‘ç»œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">networking:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dnsDomain:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster.local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  serviceSubnet:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.96.0.0/12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  podSubnet:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.244.0.0/16</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# æ·»åŠ è¿™ä¸ª</span></span></code></pre></div><p>åœ¨ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>kubeadm</code> æ‹‰å–æˆ‘ä»¬çš„é»˜è®¤ç»„ä»¶é•œåƒã€‚ç›´æ¥ä½¿ç”¨ <code>kubeadm config images pull</code> å‘½ä»¤å³å¯</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init-kubeadm.conf</span></span></code></pre></div><h4 id="åˆå§‹åŒ–-kubernetes" tabindex="-1">åˆå§‹åŒ– Kubernetes â€‹</h4><p>åœ¨é•œåƒæ‹‰å–åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åˆšæ‰ç¼–è¾‘å¥½çš„é…ç½®æ–‡ä»¶å»åˆå§‹åŒ– <code>Kubernetes</code> é›†ç¾¤äº†ã€‚è¿™é‡Œç›´æ¥ä½¿ç”¨ <code>kubeadm init</code> å‘½ä»¤å»åˆå§‹åŒ–å³å¯ã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init-kubeadm.conf</span></span></code></pre></div><p>åœ¨é™ç­‰è¿è¡Œä¸€ä¼šåï¼Œç»ˆç«¯ä¼šç»™å‡ºä»¥ä¸‹æç¤ºï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db8feb814d8549478e7589862b0a9e50~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" loading="lazy"></p><p>å…¶ä¸­ï¼Œçº¢æ¡†å‘½ä»¤ä¸ºåœ¨ <code>Master</code> èŠ‚ç‚¹éœ€è¦æ‰§è¡Œçš„åˆå§‹åŒ–å‘½ä»¤ï¼Œå…¶ä½œç”¨ä¸ºå°†é»˜è®¤çš„ <code>Kubernetes</code> è®¤è¯æ–‡ä»¶æ‹·è´è¿› <code>.kube</code> æ–‡ä»¶å¤¹å†…ï¼Œæ‰èƒ½é»˜è®¤ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ã€‚</p><p>è“æ¡†ä¸ºéœ€è¦åœ¨ <code>node</code> èŠ‚ç‚¹æ‰§è¡Œçš„å‘½ä»¤ã€‚ä½œç”¨æ˜¯å¯ä»¥å¿«é€Ÿå°† <code>Node</code> èŠ‚ç‚¹åŠ å…¥åˆ° <code>Master</code> é›†ç¾¤å†…ã€‚</p><h4 id="å®‰è£…-flannel" tabindex="-1">å®‰è£… Flannel â€‹</h4><p>å‰é¢æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰æåˆ°è¿‡<strong>é…ç½®Podå­ç½‘ç»œ</strong>ï¼Œ<code>Flannel</code> ä¸»è¦çš„ä½œç”¨å°±æ˜¯å¦‚æ­¤ã€‚<strong>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œè®©ä¸åŒèŠ‚ç‚¹ä¸‹çš„æœåŠ¡æœ‰ç€å…¨å±€å”¯ä¸€çš„IPåœ°å€ï¼Œä¸”æœåŠ¡ä¹‹å‰å¯ä»¥äº’ç›¸è®¿é—®å’Œè¿æ¥</strong>ã€‚</p><p>é‚£ä¹ˆ <code>Flannel</code> ä½œä¸º <code>Kubernetes</code> çš„ä¸€ä¸ªç»„ä»¶ï¼Œåˆ™ä½¿ç”¨ <code>Kubernetes</code> éƒ¨ç½²æœåŠ¡çš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚é¦–å…ˆä¸‹è½½é…ç½®æ–‡ä»¶ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/coreos/flannel/v0.18.1/Documentation/kube-flannel.yml</span></span></code></pre></div><blockquote><p>åœ¨è¿™é‡Œï¼Œå¦‚æœæç¤ºä½  <code>raw.githubusercontent.com</code> æ— æ³•è®¿é—®æˆ–è¿æ¥è¶…æ—¶ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹åŠæ³•ï¼š</p><ol><li>å» githubusercontent.com.ipaddress.com/raw.githubuâ€¦ è·å–æ–°çš„IP</li><li>ç¼–è¾‘ hosts æ–‡ä»¶ï¼Œå°†è·å–çš„æ–°IPç›´æ¥æ˜ å°„åˆ°åŸŸåä¸Š</li></ol></blockquote><p>æ¥ç€æˆ‘ä»¬æ‰‹åŠ¨æ‹‰å–ä¸‹ <code>flannel</code> é•œåƒã€‚æ‰¾åˆ°ç¼–å†™é•œåƒåç§°å’Œç‰ˆæœ¬çš„åœ°æ–¹ï¼Œä½¿ç”¨ <code>docker pull</code> æ‰‹åŠ¨æ‹‰å–ä¸€ä¸‹é•œåƒï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9845d5d48e9482d9cd2d8fe39d6a159~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" loading="lazy"></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quay.io/coreos/flannel:v0.13.0-rc2</span></span></code></pre></div><p>ç­‰å¾…é•œåƒæ‹‰å–ç»“æŸåï¼Œå¯ä»¥ä½¿ç”¨ <code>kubectl apply</code> å‘½ä»¤åŠ è½½ä¸‹æœåŠ¡ã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-flannel.yml</span></span></code></pre></div><h4 id="æŸ¥çœ‹å¯åŠ¨æƒ…å†µ" tabindex="-1">æŸ¥çœ‹å¯åŠ¨æƒ…å†µ â€‹</h4><p>åœ¨å¤§çº¦ç¨å1åˆ†é’Ÿå·¦å³ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>kubectl get nodes</code> å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ã€‚å¦‚æœ <code>STATUS = ready</code>ï¼Œåˆ™ä»£è¡¨å¯åŠ¨æˆåŠŸã€‚</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span></code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f34db98ce655498f859569afce848c14~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" loading="lazy"></p><h3 id="nodeèŠ‚ç‚¹é…ç½®" tabindex="-1">NodeèŠ‚ç‚¹é…ç½® â€‹</h3><p><strong>åœ¨å®‰è£… <code>Node</code> èŠ‚ç‚¹å‰ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æ“ä½œä¸€éä¸Šé¢çš„ <code>åŸºç¡€å®‰è£…</code></strong>ã€‚ <code>Node</code> èŠ‚ç‚¹çš„åœ°ä½åˆ™æ˜¯è´Ÿè´£è¿è¡ŒæœåŠ¡å®¹å™¨ï¼Œè´Ÿè´£æ¥æ”¶è°ƒåº¦çš„ã€‚</p><p>é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œè¿˜æ˜¯éœ€è¦å…ˆè®¾ç½®ä¸€ä¸‹ <code>hostname</code> ä¸º <code>node1</code> ã€‚åœ¨ <code>node</code> æœºå™¨ä¸Šæ‰§è¡Œï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node1</span></span></code></pre></div><h4 id="æ‹·è´-master-èŠ‚ç‚¹é…ç½®æ–‡ä»¶" tabindex="-1">æ‹·è´ Master èŠ‚ç‚¹é…ç½®æ–‡ä»¶ â€‹</h4><p>æ¥ç€å°† <code>master</code> èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶æ‹·è´ <code>k8s</code> åˆ° <code>node</code> èŠ‚ç‚¹ã€‚å›åˆ°åœ¨ <code>master</code> èŠ‚ç‚¹ï¼Œä½¿ç”¨ <code>scp</code> å‘½ä»¤é€šè¿‡ <code>SSH</code>ä¼ é€æ–‡ä»¶ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.kube/config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root@nodeçš„ip:~/</span></span></code></pre></div><p>éšååœ¨ <code>node</code> èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå½’æ¡£é…ç½®æ–‡ä»¶ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.kube</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.kube/config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.kube/config</span></span></code></pre></div><h4 id="åŠ å…¥-master-èŠ‚ç‚¹" tabindex="-1">åŠ å…¥ Master èŠ‚ç‚¹ â€‹</h4><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨åˆšæ‰åœ¨ <code>master</code> ç”Ÿæˆçš„èŠ‚ç‚¹åŠ å…¥å‘½ä»¤ï¼Œåœ¨ <code>node</code> æœºå™¨ä¸Šæ‰§è¡Œã€‚è®© <code>Node</code> èŠ‚ç‚¹åŠ å…¥åˆ° <code>master</code> é›†ç¾¤å†…ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿™æ˜¯ä¸€æ¡æ˜¯ç¤ºä¾‹å‘½ä»¤ï¼ï¼ï¼ï¼ï¼ï¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.16.81.164:6443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abcdef.0123456789abcdef</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sha256:b4a059eeffa2e52f2eea7a5d592be10c994c7715c17bda57bbc3757d4f13903d</span></span></code></pre></div><p>å¦‚æœåˆšæ‰çš„å‘½ä»¤ä¸¢äº†ï¼Œå¯ä»¥åœ¨ <code>master</code> æœºå™¨ä¸Šä½¿ç”¨ <code>kubeadm token create</code> é‡æ–°ç”Ÿæˆä¸€æ¡å‘½ä»¤ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --print-join-command</span></span></code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b71c8a1c2734e2ba87867270357302d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" loading="lazy"></p><h4 id="å®‰è£…-flannel-1" tabindex="-1">å®‰è£… Flannel â€‹</h4><p><strong>è¿™é‡Œå’Œ Master å®‰è£…æ‰§è¡Œæ–¹å¼ä¸€æ ·ï¼Œå‚è€ƒåŒä¸Šã€‚</strong></p><h3 id="ç»“æŸè¯­" tabindex="-1">ç»“æŸè¯­ â€‹</h3><p>åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬ä» <code>0-1</code> éƒ¨ç½²äº†ä¸€å¥— <code>Kubernetes</code> é›†ç¾¤ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†åœ¨é›†ç¾¤å†…è¿è¡Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªåº”ç”¨ã€‚åŠ æ²¹ ğŸ’ª</p><p>å¦‚æœä½ æœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚</p>`,106),p=[t];function l(h,d,k,c,o,r){return a(),i("div",null,p)}const C=s(n,[["render",l]]);export{b as __pageData,C as default};
