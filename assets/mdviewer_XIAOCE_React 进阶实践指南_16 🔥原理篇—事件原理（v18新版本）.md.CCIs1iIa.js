import{_ as s}from"./app.BdTF1atn.js";import{j as i,i as a,Z as n}from"./chunks/@vue.D6nrJjhM.js";/* empty css                          */import"./chunks/@vueuse.ErXst1iV.js";const v=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"mdviewer/XIAOCE/React è¿›é˜¶å®è·µæŒ‡å—/16 ğŸ”¥åŸç†ç¯‡â€”äº‹ä»¶åŸç†ï¼ˆv18æ–°ç‰ˆæœ¬ï¼‰.md","filePath":"mdviewer/XIAOCE/React è¿›é˜¶å®è·µæŒ‡å—/16 ğŸ”¥åŸç†ç¯‡â€”äº‹ä»¶åŸç†ï¼ˆv18æ–°ç‰ˆæœ¬ï¼‰.md"}'),t={name:"mdviewer/XIAOCE/React è¿›é˜¶å®è·µæŒ‡å—/16 ğŸ”¥åŸç†ç¯‡â€”äº‹ä»¶åŸç†ï¼ˆv18æ–°ç‰ˆæœ¬ï¼‰.md"},h=n(`<h2 id="è¿‡æ—¶çš„-react-api" tabindex="-1">è¿‡æ—¶çš„ React API â€‹</h2><h3 id="ä¸€-å‰è¨€" tabindex="-1">ä¸€ å‰è¨€ â€‹</h3><p>åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†è€ç‰ˆæœ¬çš„äº‹ä»¶åŸç†ï¼Œè€ç‰ˆæœ¬çš„äº‹ä»¶åŸç†æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œæ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µçš„äº‹ä»¶éƒ½æ˜¯æ¨¡æ‹Ÿçš„ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨å†’æ³¡é˜¶æ®µæ‰§è¡Œçš„ï¼Œæ¯”å¦‚å¦‚ä¸‹ä¾‹å­ä¸­ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> refObj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;äº‹ä»¶ç›‘å¬&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        refObj.current.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;click&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,handler)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            refObj.current.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;click&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,handler)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },[])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å†’æ³¡é˜¶æ®µæ‰§è¡Œ&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleCaptureClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æ•è·é˜¶æ®µæ‰§è¡Œ&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{refObj} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{handleClick} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onClickCapture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{handleCaptureClick} &gt;ç‚¹å‡»&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¦‚ä¸Šé€šè¿‡ onClickï¼ŒonClickCapture å’ŒåŸç”Ÿçš„ DOM ç›‘å¬å™¨ç»™å…ƒç´  button ç»‘å®šäº†ä¸‰ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œé‚£ä¹ˆå½“è§¦å‘ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶çš„æ—¶å€™ï¼Œå¤„ç†å‡½æ•°çš„æ‰§è¡Œï¼Œè€ç‰ˆæœ¬æ‰“å°é¡ºåºä¸ºï¼š</p><p>è€ç‰ˆæœ¬äº‹ä»¶ç³»ç»Ÿï¼šäº‹ä»¶ç›‘å¬ -&gt; æ•è·é˜¶æ®µæ‰§è¡Œ -&gt; å†’æ³¡é˜¶æ®µæ‰§è¡Œ</p><p>ä½†æ˜¯è€ç‰ˆæœ¬çš„äº‹ä»¶ç³»ç»Ÿï¼Œä¸€å®šç¨‹åº¦ä¸Šï¼Œä¸ç¬¦åˆäº‹ä»¶æµçš„æ‰§è¡Œæ—¶æœºï¼Œä½†æ˜¯åœ¨æ–°ç‰ˆæœ¬ v18 çš„äº‹ä»¶ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªé—®é¢˜å¾—ä»¥è§£å†³ã€‚</p><p>æ–°ç‰ˆæœ¬äº‹ä»¶ç³»ç»Ÿï¼šæ•è·é˜¶æ®µæ‰§è¡Œ -&gt; äº‹ä»¶ç›‘å¬ -&gt; å†’æ³¡é˜¶æ®µæ‰§è¡Œ</p><p>é‚£ä¹ˆæ–°ç‰ˆæœ¬äº‹ä»¶ç³»ç»Ÿæœ‰å“ªé‡Œæ”¹å˜å‘¢ï¼Ÿ æœ¬ç« èŠ‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ–°ç‰ˆæœ¬çš„äº‹ä»¶ç³»ç»ŸåŸç†ã€‚</p><p>å¯¹äº React äº‹ä»¶åŸç†æŒ–æ˜ï¼Œä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼Œé‚£å°±æ˜¯<strong>äº‹ä»¶ç»‘å®š</strong>å’Œ<strong>äº‹ä»¶è§¦å‘</strong>ã€‚</p><h3 id="äºŒ-äº‹ä»¶ç»‘å®šâ€”â€”äº‹ä»¶åˆå§‹åŒ–" tabindex="-1">äºŒ äº‹ä»¶ç»‘å®šâ€”â€”äº‹ä»¶åˆå§‹åŒ– â€‹</h3><p>åœ¨ React æ–°ç‰ˆçš„äº‹ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨ createRoot ä¼šä¸€å£æ°”å‘å¤–å±‚å®¹å™¨ä¸Šæ³¨å†Œå®Œå…¨éƒ¨äº‹ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°ç»†èŠ‚ï¼š</p><blockquote><p>react-dom/client.js</p></blockquote><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* çœå»å’Œäº‹ä»¶æ— å…³çš„ä»£ç ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹æ³•æ³¨å†Œäº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    listenToAllSupportedEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rootContainerElement);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>åœ¨ createRoot ä¸­ï¼Œé€šè¿‡ listenToAllSupportedEvents æ³¨å†Œäº‹ä»¶ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•åšäº†äº›ä»€ä¹ˆï¼š</p><blockquote><p>react-dom/src/events/DOMPluginEventSystem.js</p></blockquote><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listenToAllSupportedEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rootContainerElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* allNativeEvents æ˜¯ä¸€ä¸ª set é›†åˆï¼Œä¿å­˜äº†å¤§å¤šæ•°çš„æµè§ˆå™¨äº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    allNativeEvents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (domEventName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;selectionchange&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         /* nonDelegatedEvents ä¿å­˜äº† js ä¸­ï¼Œä¸å†’æ³¡çš„äº‹ä»¶ */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nonDelegatedEvents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domEventName)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          /* åœ¨å†’æ³¡é˜¶æ®µç»‘å®šäº‹ä»¶ */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          listenToNativeEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domEventName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rootContainerElement);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* åœ¨æ•è·é˜¶æ®µç»‘å®šäº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        listenToNativeEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domEventName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rootContainerElement);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>listenToAllSupportedEvents è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæ ¸å¿ƒï¼Œä¸»è¦ç›®çš„å°±æ˜¯é€šè¿‡ listenToNativeEvent ç»‘å®šæµè§ˆå™¨äº‹ä»¶ï¼Œè¿™é‡Œå¼•å‡ºäº†ä¸¤ä¸ªå¸¸é‡ï¼ŒallNativeEvents å’Œ nonDelegatedEvents ï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨çš„æ„æ€å¦‚ä¸‹ï¼š</p><p>allNativeEventsï¼šallNativeEvents æ˜¯ä¸€ä¸ª set é›†åˆï¼Œä¿å­˜äº† 81 ä¸ªæµè§ˆå™¨å¸¸ç”¨äº‹ä»¶ã€‚ nonDelegatedEvents ï¼šè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªé›†åˆï¼Œä¿å­˜äº†æµè§ˆå™¨ä¸­ä¸ä¼šå†’æ³¡çš„äº‹ä»¶ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯åª’ä½“äº‹ä»¶ï¼Œæ¯”å¦‚ pauseï¼Œplayï¼Œplaying ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šäº‹ä»¶ï¼Œæ¯”å¦‚ cancel ï¼Œcloseï¼Œinvalidï¼Œloadï¼Œscroll ã€‚</p><p>æ¥ä¸‹æ¥å¦‚æœäº‹ä»¶æ˜¯ä¸å†’æ³¡çš„ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒlistenToNativeEventï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º true ã€‚ å¦‚æœæ˜¯å¸¸è§„çš„äº‹ä»¶ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œä¸¤æ¬¡ listenToNativeEventï¼Œåˆ†åˆ«åœ¨å†’æ³¡å’Œæ•è·é˜¶æ®µç»‘å®šäº‹ä»¶ã€‚</p><p>é‚£ä¹ˆ listenToNativeEvent å°±æ˜¯äº‹ä»¶ç›‘å¬ï¼Œè¿™ä¸ªå‡½æ•°è¿™é‡Œç»™å®ƒç²¾ç®€åŒ–ï¼ŒlistenToNativeEvent ä¸»è¦é€»è¾‘å¦‚ä¸‹</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listener </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatchEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,domEventName,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(isCapturePhaseListener){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventType, dispatchEvent, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventType, dispatchEvent, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¦‚ä¸Šä»£ç æ˜¯æºä»£ç ç²¾ç®€åçš„ï¼Œå¹¶ä¸æ˜¯æºç ï¼ŒisCapturePhaseListener å°±æ˜¯ listenToNativeEvent çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œtarget ä¸º DOM å¯¹è±¡ã€‚dispatchEvent ä¸ºç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚</p><p>å¦‚ä¸Šå¯ä»¥çœ‹åˆ° listenToNativeEvent æœ¬è´¨ä¸Šå°±æ˜¯å‘åŸç”Ÿ DOM ä¸­å»æ³¨å†Œäº‹ä»¶ï¼Œä¸Šé¢è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯ dispatchEvent å·²ç»é€šè¿‡ bind çš„æ–¹å¼å°†äº‹ä»¶åç§°ç­‰ä¿¡æ¯ä¿å­˜ä¸‹æ¥äº†ã€‚ç»è¿‡è¿™ç¬¬ä¸€æ­¥ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå°±å·²ç»æ³¨å†Œäº†å¾ˆå¤šçš„äº‹ä»¶ç›‘å¬å™¨äº†ã€‚</p><p>æ­¤æ—¶å¦‚æœå‘ç”Ÿä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ï¼Œå°±ä¼šè§¦å‘ä¸¤æ¬¡ dispatchEvent ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡æ•è·é˜¶æ®µçš„ç‚¹å‡»äº‹ä»¶ï¼›</li><li>ç¬¬äºŒæ¬¡å†’æ³¡é˜¶æ®µçš„ç‚¹å‡»äº‹ä»¶ï¼›</li></ul><h3 id="ä¸‰-äº‹ä»¶è§¦å‘" tabindex="-1">ä¸‰ äº‹ä»¶è§¦å‘ â€‹</h3><p>æ¥ä¸‹æ¥å°±æ˜¯é‡ç‚¹ï¼Œå½“è§¦å‘ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Œé¦–å…ˆå°±æ˜¯æ‰§è¡Œ dispatchEvent äº‹ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°åšäº†äº›ä»€ä¹ˆï¼Ÿ</p><p>dispatchEvent ä¿ç•™æ ¸å¿ƒçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">batchedUpdates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatchEventsForPlugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domEventName, eventSystemFlags, nativeEvent, ancestorInst);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>dispatchEvent å¦‚æœæ˜¯æ­£å¸¸çš„äº‹ä»¶ï¼Œå°±ä¼šé€šè¿‡ batchedUpdates æ¥å¤„ç† dispatchEventsForPlugins ï¼ŒbatchedUpdates æ˜¯æ‰¹é‡æ›´æ–°çš„é€»è¾‘ï¼Œåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­å·²ç»è®²åˆ°é€šè¿‡è¿™ç§æ–¹å¼æ¥è®©æ›´æ–°å˜æˆå¯æ§çš„ã€‚æ‰€æœ‰çš„çŸ›å¤´éƒ½æŒ‡å‘äº† dispatchEventsForPlugins ï¼Œè¿™ä¸ªå‡½æ•°åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatchEventsForPlugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventSystemFlags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nativeEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">targetInst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">targetContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* æ‰¾åˆ°å‘ç”Ÿäº‹ä»¶çš„å…ƒç´ â€”â€”äº‹ä»¶æº */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nativeEventTarget </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEventTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nativeEvent);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* å¾…æ›´æ–°é˜Ÿåˆ— */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatchQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* æ‰¾åˆ°å¾…æ‰§è¡Œçš„äº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  extractEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dispatchQueue, domEventName, targetInst, nativeEvent, nativeEventTarget, eventSystemFlags);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* æ‰§è¡Œäº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  processDispatchQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dispatchQueue, eventSystemFlags);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™ä¸ªå‡½æ•°éå¸¸é‡è¦ï¼Œé¦–å…ˆé€šè¿‡ getEventTarget æ‰¾åˆ°å‘ç”Ÿäº‹ä»¶çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶æºã€‚ç„¶ååˆ›å»ºä¸€ä¸ªå¾…æ›´æ–°çš„äº‹ä»¶é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—åšä»€ä¹ˆï¼Œé©¬ä¸Šä¼šè®²åˆ°ï¼Œæ¥ä¸‹æ¥é€šè¿‡ extractEvents æ‰¾åˆ°å¾…æ›´æ–°çš„äº‹ä»¶ï¼Œç„¶åé€šè¿‡ processDispatchQueue æ‰§è¡Œäº‹ä»¶ã€‚</p><p>ä¸Šé¢çš„ä¿¡æ¯é‡æ¯”è¾ƒå¤§ï¼Œæˆ‘ä»¬ä¼šé€ä¸€è¿›è¡Œè§£æï¼Œå…ˆä¸¾ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å†’æ³¡é˜¶æ®µæ‰§è¡Œ&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleCaptureClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æ•è·é˜¶æ®µæ‰§è¡Œ&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleParentClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;div ç‚¹å‡»äº‹ä»¶&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{handleParentClick} &gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{handleClick} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onClickCapture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{handleCaptureClick} &gt;ç‚¹å‡»&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¦‚ä¸Šçš„ä¾‹å­ï¼Œæœ‰ä¸€ä¸ª div å’Œ button å‡ç»‘å®šäº†ä¸€ä¸ªæ­£å¸¸çš„ç‚¹å‡»äº‹ä»¶ ï¼Œdiv æ˜¯ button çš„çˆ¶å…ƒç´ ï¼Œé™¤æ­¤ä¹‹å¤– button ç»‘å®šäº†ä¸€ä¸ªåœ¨æ•è·é˜¶æ®µæ‰§è¡Œçš„ç‚¹å‡»äº‹ä»¶ã€‚</p><p>å½“ç‚¹å‡»æŒ‰é’®ï¼Œè§¦å‘ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶çš„æ—¶å€™ï¼Œå¦‚æœ nativeEventTarget æœ¬è´¨ä¸Šå°±æ˜¯å‘ç”Ÿç‚¹å‡»äº‹ä»¶çš„ button å¯¹åº”çš„ DOM å…ƒç´ ã€‚</p><p>é‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ dispatchQueue æ˜¯ä»€ä¹ˆï¼Ÿ extractEvents æœ‰å¦‚ä½•å¤„ç†çš„ dispatchQueueã€‚</p><p>å‘ç”Ÿç‚¹å‡»äº‹ä»¶ï¼Œé€šè¿‡ä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼Œä¼šè§¦å‘ä¸¤æ¬¡ dispatchEventsï¼Œç¬¬ä¸€æ¬¡æ˜¯æ•è·é˜¶æ®µï¼Œç¬¬äºŒæ¬¡æ˜¯å†’æ³¡é˜¶æ®µ ï¼Œä¸¤æ¬¡æˆ‘ä»¬åˆ†åˆ«æ‰“å°ä¸€ä¸‹ dispatchQueue ï¼š</p><p>ç¬¬ä¸€æ¬¡æ‰“å°ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5087c32b043467eb5525731692b4a24~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1.png"></p><p>ç¬¬äºŒæ¬¡æ‰“å°ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20584f9179b24f9c8d9088b379d95f5b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="10-8-2.png"></p><p>å¦‚ä¸Šå¯ä»¥çœ‹åˆ°ä¸¤æ¬¡ dispatchQueue ä¸­åªæœ‰ä¸€é¡¹å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€æ¬¡ç”¨æˆ·ä¸­ï¼Œäº§ç”Ÿä¸€æ¬¡äº‹ä»¶å°±ä¼šå‘ dispatchQueue æ”¾å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œä¸€ä¸ªæ˜¯ event ï¼Œä¸€ä¸ªæ˜¯ listenersã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªä¸œè¥¿æ˜¯å¦‚ä½•æ¥çš„å‘¢ï¼Ÿ</p><p>event æ˜¯é€šè¿‡äº‹ä»¶æ’ä»¶åˆæˆçš„äº‹ä»¶æº eventï¼Œåœ¨ React äº‹ä»¶ç³»ç»Ÿä¸­ï¼Œäº‹ä»¶æºä¹Ÿä¸æ˜¯åŸç”Ÿçš„äº‹ä»¶æºï¼Œè€Œæ˜¯ React è‡ªå·±åˆ›å»ºçš„äº‹ä»¶æºå¯¹è±¡ã€‚å¯¹äºä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Œä¼šåˆ›å»ºä¸åŒçš„äº‹ä»¶æºå¯¹è±¡ã€‚æœ¬è´¨ä¸Šæ˜¯åœ¨ extractEvents å‡½æ•°ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€æ®µå¤„ç†é€»è¾‘ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SyntheticEventCtor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SyntheticEvent;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* é’ˆå¯¹ä¸åŒçš„äº‹ä»¶ï¼Œå¤„ç†ä¸åŒçš„äº‹ä»¶æº */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (domEventName) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;keydown&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;keyup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      SyntheticEventCtor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SyntheticKeyboardEvent;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;focusin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      reactEventType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;focus&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      SyntheticEventCtor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SyntheticFocusEvent;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* æ‰¾åˆ°äº‹ä»¶ç›‘å¬è€…ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ onClick ç»‘å®šçš„äº‹ä»¶å¤„ç†å‡½æ•° */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _listeners </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> accumulateSinglePhaseListeners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(targetInst, reactName, nativeEvent.type, inCapturePhase, accumulateTargetOnly);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* å‘ dispatchQueue æ·»åŠ  event å’Œ listeners  */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_listeners.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SyntheticEventCtor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(reactName, reactEventType, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, nativeEvent, nativeEventTarget);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dispatchQueue.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        event: _event,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        listeners: _listeners</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¦‚ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ ¹æ®ä¸åŒäº‹ä»¶ç±»å‹ï¼Œé€‰ç”¨ä¸åŒçš„æ„é€ å‡½æ•°ï¼Œé€šè¿‡ new çš„æ–¹å¼å»åˆæˆä¸åŒäº‹ä»¶æºå¯¹è±¡ã€‚ä¸Šé¢è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯ _listeners æ˜¯ä»€ä¹ˆï¼Ÿ _listeners æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢æœ‰ä¸‰ä¸ªå±æ€§ã€‚</p><p>currentTargetï¼šå‘ç”Ÿäº‹ä»¶çš„ DOM å…ƒç´ ã€‚ instance ï¼š button å¯¹åº”çš„ fiber å…ƒç´ ã€‚ listener ï¼šä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾ç»‘å®šçš„äº‹ä»¶å¤„ç†å‡½æ•°æœ¬èº«ï¼Œä¸Šé¢ demo ä¸­å°±æ˜¯ç»‘å®šç»™ onClickï¼ŒonClickCapture çš„å‡½æ•°ã€‚</p><p>æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ DOM å…ƒç´ æ‰¾åˆ°å¯¹åº”çš„ fiberï¼Œæ‰¾åˆ°å…ƒç´ å¯¹åº”çš„ fiber ä¹‹åï¼Œä¹Ÿå°±èƒ½æ‰¾åˆ° props äº‹ä»¶äº†ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯ listener å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯”å¦‚å¦‚ä¸Šæ•è·é˜¶æ®µçš„ listener åªæœ‰ä¸€ä¸ªï¼Œè€Œå†’æ³¡é˜¶æ®µçš„ listener æœ‰ä¸¤ä¸ªï¼Œè¿™æ˜¯å› ä¸º div button ä¸Šéƒ½æœ‰ onClick äº‹ä»¶ã€‚</p><p>å¦‚ä¸Šå¯ä»¥æ€»ç»“ä¸ºï¼š</p><p><strong>å½“å‘ç”Ÿä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ï¼ŒReact ä¼šæ ¹æ®äº‹ä»¶æºå¯¹åº”çš„ fiber å¯¹è±¡ï¼Œæ ¹æ® returnæŒ‡é’ˆå‘ä¸Šéå†ï¼Œæ”¶é›†æ‰€æœ‰ç›¸åŒçš„äº‹ä»¶</strong>ï¼Œæ¯”å¦‚æ˜¯ onClickï¼Œé‚£å°±æ”¶é›†çˆ¶çº§å…ƒç´ çš„æ‰€æœ‰ onClick äº‹ä»¶ï¼Œæ¯”å¦‚æ˜¯ onClickCaptureï¼Œé‚£å°±æ”¶é›†çˆ¶çº§çš„æ‰€æœ‰ onClickCaptureã€‚</p><p>å¾—åˆ°äº† dispatchQueue ä¹‹åï¼Œå°±éœ€è¦ processDispatchQueue æ‰§è¡Œäº‹ä»¶äº†ï¼Œè¿™ä¸ªå‡½æ•°çš„å†…éƒ¨ä¼šç»å†ä¸¤æ¬¡éå†ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡éå† dispatchQueueï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªäº‹ä»¶ç±»å‹ï¼Œæ‰€æœ‰ dispatchQueue ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚</li><li>æ¥ä¸‹æ¥ä¼šéå†æ¯ä¸€ä¸ªå…ƒç´ çš„ listenerï¼Œæ‰§è¡Œ listener çš„æ—¶å€™æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* å¦‚æœåœ¨æ•è·é˜¶æ®µæ‰§è¡Œã€‚ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (inCapturePhase) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatchListeners.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatchListeners[i],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$i.instance,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          currentTarget </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$i.currentTarget,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          listener </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$i.listener;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> previousInstance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isPropagationStopped</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* æ‰§è¡Œäº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      executeDispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event, listener, currentTarget);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      previousInstance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; _i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatchListeners.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; _i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$_i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatchListeners[_i],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          _instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$_i.instance,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          _currentTarget </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$_i.currentTarget,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          _listener </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _dispatchListeners$_i.listener;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> previousInstance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isPropagationStopped</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* æ‰§è¡Œäº‹ä»¶ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      executeDispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event, _listener, _currentTarget);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      previousInstance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>å¦‚ä¸Šåœ¨ executeDispatch ä¼šè´Ÿè´£æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ handleClick ï¼ŒhandleParentClick ç­‰ã€‚è¿™ä¸ªæœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯ï¼Œå¦‚æœæ˜¯æ•è·é˜¶æ®µæ‰§è¡Œçš„å‡½æ•°ï¼Œé‚£ä¹ˆ listener æ•°ç»„ä¸­å‡½æ•°ï¼Œä¼šä»åå¾€å‰æ‰§è¡Œï¼Œå¦‚æœæ˜¯å†’æ³¡é˜¶æ®µæ‰§è¡Œçš„å‡½æ•°ï¼Œä¼šä»å‰å¾€åæ‰§è¡Œï¼Œç”¨è¿™ä¸ªæ¨¡æ‹Ÿå‡ºå†’æ³¡é˜¶æ®µå…ˆå­åçˆ¶ï¼Œæ•è·é˜¶æ®µå…ˆçˆ¶åå­ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯å¦‚æœè§¦å‘äº†é˜»æ­¢å†’æ³¡äº‹ä»¶ï¼Œä¸Šè¿°è®²åˆ°äº‹ä»¶æºæ˜¯ React å†…éƒ¨è‡ªå·±åˆ›å»ºçš„ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªäº‹ä»¶ä¸­æ‰§è¡Œäº† e.stopPropagation ï¼Œé‚£ä¹ˆäº‹ä»¶æºä¸­å°±èƒ½æ„ŸçŸ¥å¾—åˆ°ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡ event.isPropagationStopped æ¥åˆ¤æ–­æ˜¯å¦é˜»æ­¢å†’æ³¡ï¼Œå¦‚æœç»„ç»‡ï¼Œé‚£ä¹ˆå°±ä¼šé€€å‡ºï¼Œè¿™æ ·å°±æ¨¡æ‹Ÿäº†äº‹ä»¶æµçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»¥åŠé˜»æ­¢äº‹ä»¶å†’æ³¡ã€‚</p><h3 id="å››-æ€»ç»“" tabindex="-1">å›› æ€»ç»“ â€‹</h3><p>ä»¥ä¸Šå°±æ˜¯æ–°ç‰ˆæœ¬äº‹ä»¶ç³»ç»Ÿçš„åŸç†ï¼Œè¿™é‡Œç”¨ä¸€å¹…å›¾æ¥æ€»ç»“ï¼Œæ–°è€ç‰ˆæœ¬äº‹ä»¶ç³»ç»Ÿåœ¨æ¯ä¸ªé˜¶æ®µçš„åŒºåˆ«ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f893c626a7048bd95c7a02046f3a047~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="8-6-3.png"></p>`,59),p=[h];function l(k,e,E,r,d,g){return a(),i("div",null,p)}const u=s(t,[["render",l]]);export{v as __pageData,u as default};
